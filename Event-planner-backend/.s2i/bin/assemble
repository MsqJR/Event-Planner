#!/bin/bash

# S2I assemble script for Event Planner Backend

set -e

echo "Building Event Planner Backend..."
echo "Current directory: $(pwd)"
echo "HOME: $HOME"
echo "Contents:"
ls -la

# List go files
echo "Go files found:"
find . -name "*.go" -type f | head -20

# Verify go.mod exists
if [ ! -f "go.mod" ]; then
    echo "ERROR: go.mod not found in $(pwd)"
    echo "Checking parent directory..."
    ls -la ..
    exit 1
fi

# Tidy modules (will download if needed)
echo "Tidying Go modules..."
go mod tidy

# Build the application
echo "Building application..."
CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -o /opt/app-root/src/main ./cmd/main.go

echo "Build completed successfully!"
